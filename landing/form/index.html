<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kuzmanich Seguros 360 — Cotizá en minutos</title>
  <meta name="description" content="Formulario optimizado: envía tus datos al CRM (n8n) y abre WhatsApp con el mensaje prellenado para continuar la atención." />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b1020;
      --panel:#0e1429;
      --muted:#9fb0d0;
      --text:#e7ecf5;
      --brand:#22c55e;
      --brand-600:#16a34a;
      --line:rgba(255,255,255,.12);
      --shadow:0 30px 80px rgba(2,6,23,.45);
      --error:#ef4444;
      --ok:#10b981;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial; 
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 10% -10%, #0f1a3c 0%, transparent 60%),
        radial-gradient(1000px 500px at 90% 110%, #0a122c 0%, transparent 60%),
        linear-gradient(180deg,#0a0f22, var(--bg));
      min-height:100svh; display:grid; grid-template-rows:auto 1fr auto;
    }
    header{padding:22px; text-align:center; border-bottom:1px solid var(--line); background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.0));}
    header .brand{font-weight:700; letter-spacing:.2px}
    header .tag{color:var(--muted); font-size:.95rem}
    .wrap{width:100%; max-width:900px; margin:32px auto; padding:0 18px}
    .hero{text-align:center; margin-bottom:18px}
    .hero h1{margin:0 0 8px; font-size:clamp(1.4rem,1.1rem + 1.6vw,2rem)}
    .hero p{margin:0; color:var(--muted)}
    .grid{display:grid; grid-template-columns:1fr; gap:18px}
    @media(min-width:880px){.grid{grid-template-columns:3fr 2fr}}
    .card{background:var(--panel); border:1px solid var(--line); border-radius:20px; box-shadow:var(--shadow)}
    .card .body{padding:22px}
    form{display:grid; grid-template-columns:1fr; gap:14px}
    .row{display:grid; grid-template-columns:1fr; gap:14px}
    @media(min-width:720px){.row{grid-template-columns:1fr 1fr}}
    label{display:block; font-size:.92rem; color:var(--muted); margin-bottom:6px}
    .field{position:relative}
    input, select, textarea{width:100%; background:#0a0f22; color:var(--text); border:1px solid var(--line); border-radius:12px; padding:12px 14px; outline:none; transition:border .2s, box-shadow .2s;}
    input:focus, select:focus, textarea:focus{border-color:rgba(34,197,94,.6); box-shadow:0 0 0 3px rgba(34,197,94,.15)}
    .hint{font-size:.9rem; color:var(--muted)}
    .actions{display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-top:2px}
    button{appearance:none; border:0; cursor:pointer; font-weight:600; letter-spacing:.2px; padding:12px 18px; border-radius:12px; background:var(--brand); color:#05220f; transition:transform .2s, filter .2s}
    button:hover{transform:translateY(-1px)}
    button:disabled{filter:grayscale(.6); cursor:not-allowed}
    .ghost{background:transparent; color:var(--text); border:1px solid var(--line)}
    .status{min-height:22px; font-size:.95rem}
    .ok{color:var(--ok)} .err{color:var(--error)}
    .hp{position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden}
    .badge{display:inline-flex; align-items:center; gap:8px; font-size:.92rem; color:var(--muted)}
    .badge i{width:8px; height:8px; border-radius:50%; background:var(--brand)}
    .aside ul{list-style:none; padding:0; margin:0; display:grid; gap:10px}
    .aside li{display:flex; align-items:flex-start; gap:10px; color:var(--muted)}
    .aside li i{width:8px; height:8px; margin-top:8px; border-radius:50%; background:var(--brand)}
    footer{text-align:center; color:var(--muted); padding:18px; border-top:1px solid var(--line)}
    a{color:var(--brand)}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="brand">Kuzmanich Seguros 360</div>
      <div class="tag">Asesoramiento integral — Cotizá en minutos</div>
    </div>
  </header>

  <main class="wrap">
    <div class="hero">
      <h1>Solicitá tu cotización</h1>
      <p>Completá tus datos. Te respondemos por WhatsApp y registramos tu consulta en nuestro CRM.</p>
    </div>

    <div class="grid">
      <section class="card">
        <div class="body">
          <div class="badge"><i></i> Conexión segura a CRM (n8n + Google Sheets)</div>
          <form id="leadForm" novalidate>
            <input class="hp" type="text" name="company" tabindex="-1" autocomplete="off" />

            <div class="row">
              <div class="field">
                <label for="nombre">Nombre y apellido</label>
                <input id="nombre" name="nombre" type="text" placeholder="Juan Pérez" required />
              </div>
              <div class="field">
                <label for="dni">DNI</label>
                <input id="dni" name="dni" type="text" placeholder="Ej: 32123456" required />
              </div>
            </div>

            <div class="row">
              <div class="field">
                <label for="telefono">Teléfono (WhatsApp)</label>
                <input id="telefono" name="telefono" type="tel" inputmode="tel" placeholder="11 5555 5555" required />
              </div>
              <div class="field">
                <label for="email">Email</label>
                <input id="email" name="email" type="email" placeholder="juan@mail.com" />
              </div>
            </div>

            <div class="field">
              <label for="ramo">Ramo</label>
              <select id="ramo" name="ramo" required>
                <option value="" selected disabled>Elegí una opción</option>
                <option>Automotor</option>
                <option>Hogar</option>
                <option>Vida</option>
                <option>Retiro</option>
                <option>Salud</option>
                <option>ART</option>
                <option>Otros</option>
              </select>
            </div>

            <div class="field">
              <label for="detalle">Detalle (marca, modelo y año)</label>
              <input id="detalle" name="detalle" type="text" placeholder="Toyota Etios XLS 2022" />
            </div>

            <div class="field">
              <label for="mensaje">Mensaje (opcional)</label>
              <textarea id="mensaje" name="mensaje" rows="3" placeholder="Contanos algo más si querés…"></textarea>
            </div>

            <label class="hint"><input type="checkbox" id="consent" required /> Acepto ser contactad@ por WhatsApp / email</label>

            <div class="actions">
              <button id="submitBtn" type="submit">Enviar y abrir WhatsApp</button>
              <button class="ghost" type="reset">Limpiar</button>
              <span id="status" class="status" aria-live="polite"></span>
            </div>

            <input type="hidden" id="utm_source" name="utm_source" />
            <input type="hidden" id="utm_medium" name="utm_medium" />
            <input type="hidden" id="utm_campaign" name="utm_campaign" />
          </form>
        </div>
      </section>

      <aside class="card aside">
        <div class="body">
          <h3 style="margin-top:0">¿Por qué con nosotros?</h3>
          <ul>
            <li><i></i> Productores oficiales. Cotizamos con la compañía número 1 del mercado.</li>
            <li><i></i> Respuesta ágil por WhatsApp. Sin vueltas.</li>
            <li><i></i> Tus datos quedan protegidos. Uso exclusivo para tu cotización.</li>
          </ul>
          <p class="hint" style="margin-top:12px">Al enviar aceptás nuestros <a href="#" rel="nofollow">Términos</a> y <a href="#" rel="nofollow">Privacidad</a>.</p>
        </div>
      </aside>
    </div>
  </main>

  <footer>
    © Kuzmanich Seguros 360 — Todos los derechos reservados
  </footer>

  <script>
    const N8N_WEBHOOK_URL = "https://orgkuzmanich.app.n8n.cloud/webhook/lead-ingest";
    const PRODUCER_WSP = "5492804641495";

    const enc = (s) => encodeURIComponent(String(s ?? '').trim());
    const onlyDigits = (s) => String(s ?? '').replace(/\D+/g,'');

    function fetchWithTimeout(url, options = {}, timeoutMs = 5000){
      const ctrl = new AbortController();
      const id = setTimeout(() => ctrl.abort(), timeoutMs);
      return fetch(url, { ...options, signal: ctrl.signal }).finally(() => clearTimeout(id));
    }

    function buildWaText(d){
      const parts = [
        'Hola, quiero una cotización:',
        `• Nombre: ${d.nombre}`,
        `• DNI: ${d.dni}`,
        `• Teléfono: ${d.telefono}`,
        d.email ? `• Email: ${d.email}` : null,
        `• Ramo: ${d.ramo}`,
        d.detalle ? `• Detalle: ${d.detalle}` : null,
        d.mensaje ? `• Mensaje: ${d.mensaje}` : null,
        '— Enviado desde el formulario web'
      ].filter(Boolean).join('\n');
      return enc(parts);
    }

    (function setUTMs(){
      const p = new URLSearchParams(location.search);
      for (const k of ['utm_source','utm_medium','utm_campaign']){
        const v = p.get(k); if (v) document.getElementById(k).value = v;
      }
    })();

    const form = document.getElementById('leadForm');
    const statusEl = document.getElementById('status');
    const submitBtn = document.getElementById('submitBtn');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusEl.textContent = '';
      if (form.company && form.company.value) {
        statusEl.textContent = 'Detectamos actividad inusual. Volvé a intentar.';
        statusEl.className = 'status err';
        return;
      }
      if (!form.checkValidity()){
        statusEl.textContent = 'Revisá los campos requeridos.';
        statusEl.className = 'status err';
        return;
      }
      const telefonoDigits = onlyDigits(form.telefono.value);
      const payload = {
        nombre: form.nombre.value.trim(),
        dni: form.dni.value.trim(),
        telefono: telefonoDigits,
        email: form.email.value.trim(),
        ramo: form.ramo.value,
        detalle: form.detalle.value.trim(),
        mensaje: form.mensaje.value.trim(),
        utm_source: document.getElementById('utm_source').value,
        utm_medium: document.getElementById('utm_medium').value,
        utm_campaign: document.getElementById('utm_campaign').value,
        source: location.hostname || 'local',
        timestamp: new Date().toISOString()
      };
      submitBtn.disabled = true; submitBtn.textContent = 'Enviando…';
      let delivered = false;
      try {
        const res = await fetchWithTimeout(N8N_WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        }, 6000);
        delivered = true;
        if (res && res.type !== 'opaque') delivered = res.ok;
      } catch (err) { console.warn('No se pudo confirmar el webhook:', err); }
      const waText = buildWaText(payload);
      const waURL = `https://wa.me/${PRODUCER_WSP}?text=${waText}`;
      if (delivered){ statusEl.textContent = '¡Perfecto! Registramos tu consulta. Abriendo WhatsApp…'; statusEl.className = 'status ok'; }
      else { statusEl.textContent = 'No pudimos confirmar el envío al CRM, pero abrimos WhatsApp para continuar.'; statusEl.className = 'status err'; }
      window.open(waURL, '_blank');
      setTimeout(()=>{ submitBtn.disabled = false; submitBtn.textContent = 'Enviar y abrir WhatsApp'; }, 2200);
    });
  </script>
</body>
</html>
