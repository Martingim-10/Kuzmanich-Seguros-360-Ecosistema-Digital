<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Kuzmanich Seguros 360 ‚Äî Solicitud de Cotizaci√≥n</title>
  <meta name="description" content="Cotiz√° seguros personales y empresariales con Kuzmanich Seguros 360. Respuesta r√°pida y asesoramiento profesional.">
  <style>
    :root{
      --bg:#0f172a; --panel:#111827; --panel-2:#1f2937; --text:#e5e7eb; --muted:#94a3b8;
      --brand:#3b82f6; --brand-2:#60a5fa; --ok:#22c55e; --err:#ef4444;
      --input:#0b1220; --stroke:#233046; --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
      background: radial-gradient(1200px 600px at 20% -10%, #1e293b 0%, transparent 60%),
                  radial-gradient(1000px 600px at 120% 20%, #0b1220 0%, transparent 60%),
                  var(--bg);
      color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;
      padding:24px;
    }
    .card{
      width:100%; max-width:560px; background:linear-gradient(180deg,var(--panel),var(--panel-2));
      border:1px solid var(--stroke); border-radius:var(--radius); padding:28px 24px 24px;
      box-shadow:0 20px 50px rgba(0,0,0,.45);
    }
    .header{display:flex; gap:14px; align-items:center; margin-bottom:12px;}
    .header img{
      width:54px; height:54px; border-radius:12px; background:#0b1220; object-fit:contain;
      border:1px solid var(--stroke);
    }
    h1{font-size:1.35rem; margin:0; color:var(--brand-2)}
    .sub{color:var(--muted); font-size:.95rem; margin:6px 0 18px}
    .row{display:flex; gap:12px}
    .row>.field{flex:1}
    label{display:block; font-size:.9rem; color:#cbd5e1; margin:14px 0 6px}
    input,select,textarea{
      width:100%; padding:12px 12px; border-radius:12px; border:1px solid var(--stroke);
      background:var(--input); color:var(--text); font-size:1rem; outline:none;
    }
    input:focus,select:focus,textarea:focus{border-color:var(--brand)}
    .hint{font-size:.82rem; color:var(--muted); margin-top:6px}
    .consent{display:flex; gap:10px; align-items:flex-start; margin-top:14px; font-size:.9rem; color:#cbd5e1}
    .consent input{margin-top:3px}
    button{
      width:100%; margin-top:18px; padding:12px 14px; border:none; border-radius:12px;
      background:linear-gradient(180deg,var(--brand),var(--brand-2)); color:white; font-weight:700;
      cursor:pointer; transition:transform .05s ease;
    }
    button:disabled{opacity:.55; cursor:not-allowed}
    button:active{transform:translateY(1px)}
    .msg{margin-top:12px; font-weight:600; display:none}
    .msg.ok{color:var(--ok)}
    .msg.err{color:var(--err)}
    .foot{margin-top:12px; font-size:.8rem; color:var(--muted); text-align:center}
    @media (max-width:520px){ .row{flex-direction:column} }
  </style>
</head>
<body>
  <main class="card">
    <div class="header">
      <img src="https://martingim-10.github.io/Kuzmanich-Seguros-360-Ecosistema-Digital/branding/logo-rs.png" alt="Logo Kuzmanich Seguros 360" onerror="this.style.display='none'">
      <div>
        <h1>Solicitud de cotizaci√≥n</h1>
        <div class="sub">Atenci√≥n profesional en seguros personales y empresariales.</div>
      </div>
    </div>

    <form id="leadForm" novalidate>
      <div class="row">
        <div class="field">
          <label>Nombre completo</label>
          <input id="nombre" name="nombre" required placeholder="Ej: Mart√≠n Kuzmanich" autocomplete="name">
        </div>
        <div class="field">
          <label>Tel√©fono (con c√≥digo de √°rea)</label>
          <input id="telefono" name="telefono" required placeholder="+54 9 351 000 0000" inputmode="tel" pattern="^[0-9+()\\-.\\s]{7,}$">
        </div>
      </div>

      <label>Email</label>
      <input id="email" name="email" type="email" placeholder="tu@email.com" autocomplete="email">
      <div class="hint">Usaremos tu email solo para enviarte tu propuesta. No hacemos spam.</div>

      <label>Ramo</label>
      <select id="ramo" name="ramo" required>
        <option value="">Seleccion√°‚Ä¶</option>
        <option value="retiro">Seguro de Retiro</option>
        <option value="vida">Vida</option>
        <option value="automotor">Automotor</option>
        <option value="hogar">Hogar</option>
        <option value="salud">Salud</option>
        <option value="empresas">Empresas</option>
      </select>

      <!-- Campos AUTOMOTOR -->
      <div id="autoFields" style="display:none; margin-top:8px">
        <label>Marca, Modelo y Versi√≥n</label>
        <input id="auto_mm" placeholder="Ej: Toyota Etios XLS">

        <label>A√±o de producci√≥n</label>
        <input id="auto_anio" inputmode="numeric" placeholder="Ej: 2020">

        <label>DNI del tomador</label>
        <input id="auto_dni" inputmode="numeric" placeholder="Ej: 12555777">
        <div class="hint">Estos datos son necesarios para la IA de SanCor.</div>
      </div>

      <!-- Tracking -->
      <input id="canal" type="hidden" value="instagram">
      <input id="estado" type="hidden" value="nuevo">
      <input id="asesor" type="hidden" value="auto">
      <input id="origen" type="hidden" value="form">

      <label>Comentarios (opcional)</label>
      <textarea id="comentarios" name="comentarios" rows="3" placeholder="Contanos algo que debamos tener en cuenta"></textarea>

      <label class="consent">
        <input id="consent" type="checkbox" required>
        <span>Acepto el uso de mis datos para recibir mi cotizaci√≥n y asesoramiento (Ley 25.326). <a href="#" style="color:#93c5fd;text-decoration:underline">Pol√≠tica de privacidad</a>.</span>
      </label>

      <button id="submitBtn" type="submit" disabled>Enviar solicitud</button>
      <div id="msg" class="msg"></div>

      <!-- Acciones post-env√≠o Automotor -->
      <div id="autoActions" style="display:none; margin-top:10px">
        <button type="button" id="btnWa" style="margin-top:8px">üì≤ Chatear ahora por WhatsApp</button>
        <button type="button" id="btnCopy" style="margin-top:8px">üìã Copiar mensaje</button>
      </div>
    </form>

    <div class="foot">Kuzmanich Seguros 360 ¬∑ Atenci√≥n personalizada</div>
  </main>

  <script>
    const URL = "https://orgkuzmanich.app.n8n.cloud/webhook/lead-ingest";

    // üî¢ N√öMEROS (solo d√≠gitos). Obligatorio TU_WA_NUMBER.
    const SANCOR_WA_NUMBER = "5493493668558";   // opcional, por si lo usamos luego
    const TU_WA_NUMBER     = "5492804641495";   // TU n√∫mero/puente registrado en SanCor

    const form   = document.getElementById('leadForm');
    const msg    = document.getElementById('msg');
    const btn    = document.getElementById('submitBtn');
    const okTel  = document.getElementById('telefono');
    const okCons = document.getElementById('consent');

    const ramoSel     = document.getElementById('ramo');
    const autoFields  = document.getElementById('autoFields');
    const autoActions = document.getElementById('autoActions');
    const btnWa       = document.getElementById('btnWa');
    const btnCopy     = document.getElementById('btnCopy');

    // Mostrar/ocultar campos Automotor
    ramoSel.addEventListener('change', () => {
      const isAuto = ramoSel.value === 'automotor';
      autoFields.style.display  = isAuto ? 'block' : 'none';
      autoActions.style.display = 'none';
    });

    // Habilitar bot√≥n solo con consentimiento
    okCons.addEventListener('change', () => { btn.disabled = !okCons.checked; });

    // Arma el texto ‚ÄúIA SanCor‚Äù
    function buildSanCorText() {
      const mmv  = (document.getElementById('auto_mm')?.value || '').trim();
      const anio = (document.getElementById('auto_anio')?.value || '').trim();
      const dni  = (document.getElementById('auto_dni')?.value || '').trim();
      return `Quiero cotizar un ${mmv} del a√±o ${anio}, para el DNI ${dni}.`;
    }
    function waLink(toNumber, text) {
      return `https://wa.me/${toNumber}?text=${encodeURIComponent(text)}`;
    }

    // Env√≠a SIEMPRE a n8n/Sheets (incluye automotor si corresponde)
    async function logLead(payload) {
      const res = await fetch(URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error("HTTP " + res.status);
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      msg.style.display='none'; msg.className='msg';

      // Validaci√≥n base
      if (!form.checkValidity()) {
        msg.textContent = "Revis√° los campos requeridos.";
        msg.classList.add('err'); msg.style.display='block';
        return;
      }
      if (!/^[0-9+()\\-.\\s]{7,}$/.test(okTel.value.trim())) {
        msg.textContent = "Ingres√° un tel√©fono v√°lido.";
        msg.classList.add('err'); msg.style.display='block';
        return;
      }

      // Si es Automotor ‚Üí esos 3 campos son obligatorios
      let auto_mmv = "", auto_anio = "", auto_dni = "";
      if (ramoSel.value === 'automotor') {
        auto_mmv  = (document.getElementById('auto_mm')?.value || '').trim();
        auto_anio = (document.getElementById('auto_anio')?.value || '').trim();
        auto_dni  = (document.getElementById('auto_dni')?.value || '').trim();
        if (!auto_mmv || !auto_anio || !auto_dni) {
          msg.textContent = "Para Automotor complet√° Marca/Modelo/Versi√≥n, A√±o y DNI.";
          msg.classList.add('err'); msg.style.display='block';
          return;
        }
      }

      // Payload FINAL (esto va a Sheets siempre)
      const payload = {
        nombre: document.getElementById('nombre').value.trim(),
        telefono: okTel.value.trim(),
        email: document.getElementById('email').value.trim(),
        ramo: ramoSel.value,
        canal: document.getElementById('canal').value,
        estado: document.getElementById('estado').value,
        asesor: document.getElementById('asesor').value,
        origen: document.getElementById('origen').value,
        comentarios: document.getElementById('comentarios').value.trim(),
        auto_mmv, auto_anio, auto_dni  // quedar√°n vac√≠os si no es automotor
      };

      btn.disabled = true; btn.textContent = "Enviando‚Ä¶";
      try {
        // 1) Registrar SIEMPRE en Sheets (con o sin WhatsApp)
        await logLead(payload);

        // 2) Feedback visible
        msg.textContent = "‚úÖ ¬°Gracias! Recibimos tu solicitud.";
        msg.classList.add('ok'); msg.style.display='block';

        // 3) Si es Automotor ‚Üí mostrar puente a tu WhatsApp
        if (ramoSel.value === 'automotor') {
          autoActions.style.display = 'block';

          // Abrir TU WhatsApp con el mensaje listo para reenviar a SanCor
          btnWa.onclick = () => {
            if (!/^\d+$/.test(TU_WA_NUMBER)) {
              alert("Configur√° TU_WA_NUMBER (tu WhatsApp) en el c√≥digo.");
              return;
            }
            const nombre = document.getElementById('nombre').value.trim();
            const tel    = document.getElementById('telefono').value.trim();
            const email  = document.getElementById('email').value.trim();

            const textoParaAsesor =
`Hola, soy *${nombre}*.
Quiero cotizar *Automotor*.

‚Ä¢ Tel√©fono: ${tel}
‚Ä¢ Email: ${email}
‚Ä¢ Veh√≠culo: ${auto_mmv}
‚Ä¢ A√±o: ${auto_anio}
‚Ä¢ DNI tomador: ${auto_dni}

(Envi√° este formato a la IA de SanCor:)
"${buildSanCorText()}"`;

            window.open(waLink(TU_WA_NUMBER, textoParaAsesor), "_blank");
          };

          // Copiar mensaje sugerido para IA SanCor
          btnCopy.onclick = async () => {
            const text = buildSanCorText();
            try { await navigator.clipboard.writeText(text);
              alert("Mensaje copiado. Pegalo en WhatsApp (chat con SanCor) y envi√°.");
            } catch { alert("No se pudo copiar autom√°ticamente. Texto:\n\n" + text); }
          };
        }

        // Reset visual (vuelve a pedir consentimiento)
        form.reset(); btn.textContent = "Enviar solicitud"; btn.disabled = true;
        autoFields.style.display = 'none';
      } catch (err) {
        msg.textContent = "No pudimos enviar tu solicitud. Intent√° nuevamente.";
        msg.classList.add('err'); msg.style.display='block';
        btn.textContent = "Enviar solicitud"; btn.disabled = false;
        console.error(err);
      }
    });
  </script>
</body>
</html>
