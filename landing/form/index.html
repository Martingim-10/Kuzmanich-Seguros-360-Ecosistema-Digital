<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Kuzmanich Seguros 360 ‚Äî Solicitud de Cotizaci√≥n</title>
  <meta name="description" content="Cotiz√° seguros personales y empresariales con Kuzmanich Seguros 360. Respuesta r√°pida y asesoramiento profesional.">
  <style>
    :root{
      --bg:#0f172a; --panel:#111827; --panel-2:#1f2937; --text:#e5e7eb; --muted:#94a3b8;
      --brand:#3b82f6; --brand-2:#60a5fa; --ok:#22c55e; --err:#ef4444;
      --input:#0b1220; --stroke:#233046; --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; display:block;
      background: radial-gradient(1200px 600px at 20% -10%, #1e293b 0%, transparent 60%),
                  radial-gradient(1000px 600px at 120% 20%, #0b1220 0%, transparent 60%),
                  var(--bg);
      color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;
      padding:24px;
    }
    /* Layout de 2 columnas */
    .wrap{max-width:980px; margin:0 auto}
    .grid{display:grid; grid-template-columns:2fr 1fr; gap:18px; align-items:start}
    @media (max-width:880px){ .grid{grid-template-columns:1fr} }

    /* Card base */
    .card{ background:linear-gradient(180deg,var(--panel),var(--panel-2)); border:1px solid var(--stroke);
      border-radius:var(--radius); box-shadow:0 20px 50px rgba(0,0,0,.45); }

    /* Form card */
    .card.form{ padding:28px 24px 24px; }
    .header{display:flex; gap:14px; align-items:center; margin-bottom:12px;}
    .header img{ width:54px; height:54px; border-radius:12px; background:#0b1220; object-fit:contain; border:1px solid var(--stroke); }
    h1{font-size:1.35rem; margin:0; color:var(--brand-2)}
    .sub{color:var(--muted); font-size:.95rem; margin:6px 0 18px}
    .row{display:flex; gap:12px}
    .row>.field{flex:1}
    label{display:block; font-size:.9rem; color:#cbd5e1; margin:14px 0 6px}
    input,select,textarea{ width:100%; padding:12px 12px; border-radius:12px; border:1px solid var(--stroke); background:var(--input); color:var(--text); font-size:1rem; outline:none; }
    input:focus,select:focus,textarea:focus{border-color:var(--brand)}
    .hint{font-size:.82rem; color:var(--muted); margin-top:6px}
    .consent{display:flex; gap:10px; align-items:flex-start; margin-top:14px; font-size:.9rem; color:#cbd5e1}
    .consent input{margin-top:3px}
    button{ width:100%; margin-top:18px; padding:12px 14px; border:none; border-radius:12px; background:linear-gradient(180deg,var(--brand),var(--brand-2)); color:white; font-weight:700; cursor:pointer; transition:transform .05s ease; }
    button:disabled{opacity:.55; cursor:not-allowed}
    button:active{transform:translateY(1px)}
    .msg{margin-top:12px; font-weight:600; display:none}
    .msg.ok{color:var(--ok)}
    .msg.err{color:var(--err)}
    .foot{margin-top:12px; font-size:.8rem; color:var(--muted); text-align:center}
    @media (max-width:520px){ .row{flex-direction:column} }

    /* Aside Por qu√© con nosotros */
    .card.aside{ padding:20px 18px }
    .aside h3{ margin:6px 0 12px; font-size:1.05rem; color:#cfe0ff }
    .benefits{ list-style:none; padding:0; margin:0; display:grid; gap:10px }
    .benefits li{ display:flex; gap:10px; align-items:flex-start; color:var(--muted) }
    .dot{ width:8px; height:8px; border-radius:50%; background:var(--brand); margin-top:9px }

    /* ‚Äî‚Äî Mini-cotizador de Retiro (solo estilos del widget) ‚Äî‚Äî */
    #retiroWidget{display:none;margin-top:12px;border-top:1px solid var(--stroke);padding-top:12px}
    #retiroWidget .rw-row{display:flex;gap:12px;flex-wrap:wrap}
    #retiroWidget .rw-row > div{flex:1 1 160px}
    #retiroWidget .rw-cta{margin-top:10px}
    #retiroWidget .rw-note{font-size:.82rem;color:var(--muted);margin-top:6px}
    #retiroWidget .rw-out{margin-top:10px;font-weight:700}
    #retiroWidget .rw-grid{display:grid;gap:10px;grid-template-columns:1fr}
    @media (max-width:520px){#retiroWidget .rw-grid{grid-template-columns:1fr}}
    @media (min-width:521px){#retiroWidget .rw-grid{grid-template-columns:1fr 1fr}}
    #retiroWidget .rw-card{background:transparent;border:1px solid var(--stroke);border-radius:12px;padding:10px}
    #retiroWidget .rw-small{font-size:.82rem;color:#cbd5e1;margin-bottom:4px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="grid">
      <!-- Columna izquierda: FORMULARIO -->
      <main class="card form">
        <div class="header">
          <img src="https://martingim-10.github.io/Kuzmanich-Seguros-360-Ecosistema-Digital/branding/logo-rs.png" alt="Logo Kuzmanich Seguros 360" onerror="this.style.display='none'">
          <div>
            <h1>Solicitud de cotizaci√≥n</h1>
            <div class="sub">Atenci√≥n profesional en seguros personales y empresariales.</div>
          </div>
        </div>

        <form id="leadForm" novalidate>
          <div class="row">
            <div class="field">
              <label>Nombre completo</label>
              <input id="nombre" name="nombre" required placeholder="Ej: Mart√≠n Kuzmanich" autocomplete="name">
            </div>
            <div class="field">
              <label>Tel√©fono (con c√≥digo de √°rea)</label>
              <input id="telefono" name="telefono" required placeholder="+54 9 351 000 0000" inputmode="tel" pattern="^[0-9\s()+.-]{7,}$">
            </div>
          </div>

          <label>Email</label>
          <input id="email" name="email" type="email" placeholder="tu@email.com" autocomplete="email">
          <div class="hint">Usaremos tu email solo para enviarte tu propuesta. No hacemos spam.</div>

          <label>Ramo</label>
          <select id="ramo" name="ramo" required>
            <option value="">Seleccion√°‚Ä¶</option>
            <option value="retiro">Seguro de Retiro</option>
            <option value="vida">Vida</option>
            <option value="automotor">Automotor</option>
            <option value="hogar">Hogar</option>
            <option value="salud">Salud</option>
            <option value="empresas">Empresas</option>
          </select>

          <!-- Campos AUTOMOTOR -->
          <div id="autoFields" style="display:none; margin-top:8px">
            <label>Marca, Modelo y Versi√≥n</label>
            <input id="auto_mm" placeholder="Ej: Toyota Etios XLS">

            <label>A√±o de producci√≥n</label>
            <input id="auto_anio" inputmode="numeric" placeholder="Ej: 2022">

            <label>DNI del tomador</label>
            <input id="auto_dni" inputmode="numeric" placeholder="Ej: 12555777">
            <div class="hint">Estos datos son necesarios para la IA de SanCor.</div>
          </div>

          <!-- ‚Äî‚Äî Mini-cotizador RETIRO (dos escenarios) ‚Äî‚Äî -->
          <div id="retiroWidget">
            <div class="row rw-row">
              <div class="field">
                <label>Edad actual</label>
                <input id="rw_edad" inputmode="numeric" placeholder="Ej: 35">
              </div>
              <div class="field">
                <label>Edad de retiro</label>
                <input id="rw_retiro" inputmode="numeric" placeholder="Ej: 65">
              </div>
              <div class="field">
                <label>Aporte mensual (ARS)</label>
                <input id="rw_aporte" inputmode="numeric" placeholder="M√≠nimo 30000" value="50000">
              </div>
            </div>

            <button type="button" id="rw_calc" class="rw-cta">Calcular proyecci√≥n</button>
            <div id="rw_err" class="msg err" style="display:none"></div>

            <div id="rw_out" class="rw-out" style="display:none">
              <div class="rw-grid">
                <div class="rw-card">
                  <div class="rw-small">Escenario 1 (‚âà 15,9% anual)</div>
                  <div id="rw_e1">‚Äî</div>
                </div>
                <div class="rw-card">
                  <div class="rw-small">Escenario 2 (‚âà 30% anual)</div>
                  <div id="rw_e2">‚Äî</div>
                </div>
              </div>
              <div class="rw-note">Proyecci√≥n en ARS. Aporte al inicio de cada mes.</div>
            </div>

            <div id="rw_actions" style="display:none;display:flex;gap:8px;flex-wrap:wrap">
              <button type="button" id="rw_wpp">üì≤ Continuar por WhatsApp</button>
            </div>

            <div class="rw-note">Estimaci√≥n simple con dos escenarios (15,9% y 30% anual). El rendimiento real puede variar.</div>
          </div>
          <!-- ‚Äî‚Äî FIN mini-cotizador RETIRO ‚Äî‚Äî -->

          <!-- Tracking -->
          <input id="canal" type="hidden" value="instagram">
          <input id="estado" type="hidden" value="nuevo">
          <input id="asesor" type="hidden" value="auto">
          <input id="origen" type="hidden" value="form">

          <label>Comentarios (opcional)</label>
          <textarea id="comentarios" name="comentarios" rows="3" placeholder="Contanos algo que debamos tener en cuenta"></textarea>

          <label class="consent">
            <input id="consent" type="checkbox" required>
            <span>Acepto el uso de mis datos para recibir mi cotizaci√≥n y asesoramiento (Ley 25.326). <a href="#" style="color:#93c5fd;text-decoration:underline">Pol√≠tica de privacidad</a>.</span>
          </label>

          <button id="submitBtn" type="submit" disabled>Enviar solicitud</button>
          <div id="msg" class="msg"></div>

          <!-- Acciones post-env√≠o Automotor -->
          <div id="autoActions" style="display:none; margin-top:10px">
            <button type="button" id="btnWa" style="margin-top:8px">üì≤ Chatear ahora por WhatsApp</button>
            <button type="button" id="btnCopy" style="margin-top:8px">üìã Copiar mensaje</button>
          </div>
        </form>

        <div class="foot">Kuzmanich Seguros 360 ¬∑ Atenci√≥n personalizada</div>
      </main>

      <!-- Columna derecha: ¬øPor qu√© con nosotros? -->
      <aside class="card aside">
        <h3>¬øPor qu√© con nosotros?</h3>
        <ul class="benefits">
          <li><span class="dot"></span> Productores oficiales. Cotizamos con la compa√±√≠a n√∫mero 1 del mercado.</li>
          <li><span class="dot"></span> Respuesta √°gil por WhatsApp. Sin vueltas.</li>
          <li><span class="dot"></span> Tus datos quedan protegidos. Uso exclusivo para tu cotizaci√≥n.</li>
        </ul>
      </aside>
    </div>
  </div>

  <script>
    const URL = "https://orgkuzmanich.app.n8n.cloud/webhook/lead-ingest";

    // üî¢ TU WhatsApp puente (solo d√≠gitos, con pa√≠s). Ej: 5493511234567
    const TU_WA_NUMBER = "5942804641495";

    const form   = document.getElementById('leadForm');
    const msg    = document.getElementById('msg');
    const btn    = document.getElementById('submitBtn');
    const okTel  = document.getElementById('telefono');
    const okCons = document.getElementById('consent');

    const ramoSel     = document.getElementById('ramo');
    const autoFields  = document.getElementById('autoFields');
    const autoActions = document.getElementById('autoActions');
    const btnWa       = document.getElementById('btnWa');
    const btnCopy     = document.getElementById('btnCopy');

    // ‚Äî‚Äî Mostrar campos Automotor s√≥lo si corresponde
    function updateAutoFields(){
      const isAuto = ramoSel.value === 'automotor';
      autoFields.style.display  = isAuto ? 'block' : 'none';
      // Mostrar/ocultar widget Retiro
      const rw = document.getElementById('retiroWidget');
      if (rw) rw.style.display = (ramoSel.value === 'retiro') ? 'block' : 'none';
    }
    ramoSel.addEventListener('change', updateAutoFields);

    function toggleSubmit(){ btn.disabled = !okCons.checked; }
    okCons.addEventListener('change', toggleSubmit);
    toggleSubmit();
    updateAutoFields();

    function buildSanCorText() {
      const mmv  = (document.getElementById('auto_mm')?.value || '').trim();
      const anio = (document.getElementById('auto_anio')?.value || '').trim();
      const dni  = (document.getElementById('auto_dni')?.value || '').trim();
      return `Quiero cotizar un ${mmv} del a√±o ${anio}, para el DNI ${dni}.`;
    }
    function waLink(toNumber, text) { return `https://wa.me/${toNumber}?text=${encodeURIComponent(text)}`; }

    async function logLead(payload) {
      const res = await fetch(URL, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) });
      if (!res.ok) throw new Error("HTTP " + res.status);
    }

    // ‚Äî‚Äî Mini-cotizador Retiro (dos escenarios)
    (function(){
      const err = document.getElementById('rw_err');
      const outWrap = document.getElementById('rw_out');
      const e1El = document.getElementById('rw_e1');
      const e2El = document.getElementById('rw_e2');
      const actions = document.getElementById('rw_actions');
      const btnCalc = document.getElementById('rw_calc');
      const btnWpp = document.getElementById('rw_wpp');

      const fmtARS = new Intl.NumberFormat('es-AR',{style:'currency',currency:'ARS',maximumFractionDigits:0});
      const mesesEntre = (e, r) => Math.max(0,(r - e) * 12);
      const acumular = (aporte, meses, tasaAnual) => {
        const m = tasaAnual/12; let v = 0;
        for (let i=0;i<meses;i++){ v = (v + aporte) * (1 + m); }
        return v;
      };
      const show = (el, v=true) => el && (el.style.display = v ? (el.id==='rw_actions' ? 'flex' : 'block') : 'none');

      function calcular(){
        show(err,false); show(outWrap,false); show(actions,false); if (err) err.textContent='';
        const edad = parseFloat(document.getElementById('rw_edad')?.value);
        const retiro = parseFloat(document.getElementById('rw_retiro')?.value);
        const aporte = parseFloat(document.getElementById('rw_aporte')?.value);

        if (isNaN(edad) || isNaN(retiro) || isNaN(aporte)){ err.textContent='Complet√° edad, edad de retiro y aporte.'; show(err,true); return; }
        if (retiro <= edad){ err.textContent='La edad de retiro debe ser mayor a la actual.'; show(err,true); return; }
        if (aporte < 30000){ err.textContent='El aporte m√≠nimo es $30.000 por mes.'; show(err,true); return; }

        const meses = mesesEntre(edad, retiro);
        const T1 = 0.159, T2 = 0.30;
        const v1 = acumular(aporte, meses, T1);
        const v2 = acumular(aporte, meses, T2);

        if (e1El) e1El.textContent = `‚âà ${fmtARS.format(v1)}`;
        if (e2El) e2El.textContent = `‚âà ${fmtARS.format(v2)}`;
        show(outWrap,true); show(actions,true);

        // Bot√≥n WhatsApp con resumen
        const nombre = (document.getElementById('nombre')?.value || '').trim();
        const tel    = (document.getElementById('telefono')?.value || '').trim();
        const email  = (document.getElementById('email')?.value || '').trim();
        const resumen = `Resumen de simulaci√≥n de Retiro:
‚Ä¢ Nombre: ${nombre || '(sin nombre)'}
‚Ä¢ Tel√©fono: ${tel || '(sin tel√©fono)'}
‚Ä¢ Email: ${email || '(sin email)'}

‚Ä¢ Edad actual: ${edad}
‚Ä¢ Edad retiro: ${retiro}
‚Ä¢ Aporte mensual: ${fmtARS.format(aporte)}
‚Ä¢ Escenario 1 (15,9%): ${fmtARS.format(v1)}
‚Ä¢ Escenario 2 (30%): ${fmtARS.format(v2)}

Quiero avanzar con mi cotizaci√≥n.`;

        const to = (window.TU_WA_NUMBER || '5492804641495').replace(/\D/g,'');
        if (btnWpp) btnWpp.onclick = () => window.open(`https://wa.me/${to}?text=${encodeURIComponent(resumen)}`,'_blank');
      }

      if (btnCalc) btnCalc.addEventListener('click', calcular);
    })();

    // ‚Äî‚Äî Submit del formulario (Automotor intacto + campos Retiro opcionales)
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      msg.style.display='none'; msg.className='msg';

      if (!form.checkValidity()) {
        msg.textContent = "Revis√° los campos requeridos.";
        msg.classList.add('err'); msg.style.display='block';
        return;
      }
      if (!(/\d{7,}/.test(okTel.value))) {
        msg.textContent = "Ingres√° un tel√©fono v√°lido (m√≠nimo 7 d√≠gitos).";
        msg.classList.add('err'); msg.style.display='block';
        return;
      }

      let auto_mmv = "", auto_anio = "", auto_dni = "";
      const isAuto = ramoSel.value === 'automotor';
      if (isAuto) {
        auto_mmv  = (document.getElementById('auto_mm')?.value || '').trim();
        auto_anio = (document.getElementById('auto_anio')?.value || '').trim();
        auto_dni  = (document.getElementById('auto_dni')?.value || '').trim();
        if (!auto_mmv || !auto_anio || !auto_dni) {
          msg.textContent = "Para Automotor complet√° Marca/Modelo/Versi√≥n, A√±o y DNI.";
          msg.classList.add('err'); msg.style.display='block';
          return;
        }
      }

      // ‚Äî‚Äî Captura opcional de RETIRO (dos escenarios)
      let retiro_edad = null, retiro_meta = null, retiro_aporte = null, retiro_esc1 = null, retiro_esc2 = null;
      const isRetiro = ramoSel.value === 'retiro';
      if (isRetiro) {
        const rEdad   = parseFloat(document.getElementById('rw_edad')?.value);
        const rMeta   = parseFloat(document.getElementById('rw_retiro')?.value);
        const rAporte = parseFloat(document.getElementById('rw_aporte')?.value);
        if (!Number.isNaN(rEdad) && !Number.isNaN(rMeta) && !Number.isNaN(rAporte)) {
          const mesesEntre = (e,r) => Math.max(0,(r - e) * 12);
          const acumular = (aporte, meses, tasa) => { let v=0, m=tasa/12; for (let i=0;i<meses;i++){ v=(v+aporte)*(1+m); } return v; };
          const meses = mesesEntre(rEdad, rMeta);
          const T1 = 0.159, T2 = 0.30;
          const v1 = acumular(rAporte, meses, T1);
          const v2 = acumular(rAporte, meses, T2);
          retiro_edad = rEdad; retiro_meta = rMeta; retiro_aporte = rAporte;
          retiro_esc1 = Math.round(v1); retiro_esc2 = Math.round(v2);
        }
      }

      const payload = {
        nombre: document.getElementById('nombre').value.trim(),
        telefono: okTel.value.trim(),
        email: document.getElementById('email').value.trim(),
        ramo: ramoSel.value,
        canal: document.getElementById('canal').value,
        estado: document.getElementById('estado').value,
        asesor: document.getElementById('asesor').value,
        origen: document.getElementById('origen').value,
        comentarios: document.getElementById('comentarios').value.trim(),
        auto_mmv, auto_anio, auto_dni,

        // ‚Äî‚Äî Campos Retiro (nulos si no aplica o no complet√≥)
        retiro_edad,
        retiro_meta,    // edad de retiro objetivo
        retiro_aporte,  // ARS/mes
        retiro_esc1,    // capital estimado (15,9%)
        retiro_esc2     // capital estimado (30%)
      };

      btn.disabled = true; btn.textContent = "Enviando‚Ä¶";
      try {
        await logLead(payload);

        msg.textContent = "‚úÖ ¬°Gracias! Recibimos tu solicitud.";
        msg.classList.add('ok'); msg.style.display='block';

        if (isAuto) {
          autoActions.style.display = 'block';
          btnWa.onclick = () => {
            if (!/^\d+$/.test(TU_WA_NUMBER)) { alert("Configur√° TU_WA_NUMBER (tu WhatsApp) en el c√≥digo."); return; }
            const nombre = document.getElementById('nombre').value.trim();
            const tel    = document.getElementById('telefono').value.trim();
            const email  = document.getElementById('email').value.trim();
            const textoParaAsesor = `Hola, soy *${nombre}*.\nQuiero cotizar *Automotor*.\n\n‚Ä¢ Tel√©fono: ${tel}\n‚Ä¢ Email: ${email}\n‚Ä¢ Veh√≠culo: ${auto_mmv}\n‚Ä¢ A√±o: ${auto_anio}\n‚Ä¢ DNI tomador: ${auto_dni}\n\n(Envi√° este formato a la IA de SanCor:)\n"${buildSanCorText()}"`;
            window.open(waLink(TU_WA_NUMBER, textoParaAsesor), "_blank");
          };
          btnCopy.onclick = async () => {
            const text = buildSanCorText();
            try { await navigator.clipboard.writeText(text); alert("Mensaje copiado. Pegalo en WhatsApp (chat con SanCor) y envi√°."); }
            catch { alert("No se pudo copiar autom√°ticamente. Texto:\n\n" + text); }
          };
        } else {
          form.reset(); toggleSubmit(); updateAutoFields();
        }

        btn.textContent = "Enviar solicitud"; btn.disabled = !okCons.checked;
      } catch (err) {
        console.error(err);
        msg.textContent = "No pudimos enviar tu solicitud. Verific√° conexi√≥n o que el flujo est√© activo.";
        msg.classList.add('err'); msg.style.display='block';
        btn.textContent = "Enviar solicitud"; btn.disabled = false;
      }
    });
  </script>
</body>
</html>
