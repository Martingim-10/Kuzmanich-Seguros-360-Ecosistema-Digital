<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Kuzmanich Seguros 360 ‚Äî Solicitud de Cotizaci√≥n</title>
  <style>
    :root{
      --bg:#0f172a; --panel:#111827; --panel-2:#1f2937; --text:#e5e7eb; --muted:#94a3b8;
      --brand:#3b82f6; --brand-2:#60a5fa; --ok:#22c55e; --err:#ef4444;
      --input:#0b1220; --stroke:#233046; --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;min-height:100vh;background:var(--bg);color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;padding:24px;
    }
    .wrap{max-width:980px;margin:0 auto}
    .grid{display:grid;grid-template-columns:2fr 1fr;gap:18px;align-items:start}
    @media(max-width:880px){.grid{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg,var(--panel),var(--panel-2));border:1px solid var(--stroke);
      border-radius:var(--radius);box-shadow:0 20px 50px rgba(0,0,0,.45);}
    .card.form{padding:28px 24px 24px;}
    .header{display:flex;gap:14px;align-items:center;margin-bottom:12px;}
    .header img{width:54px;height:54px;border-radius:12px;object-fit:contain;border:1px solid var(--stroke);}
    h1{font-size:1.35rem;margin:0;color:var(--brand-2)}
    .sub{color:var(--muted);font-size:.95rem;margin:6px 0 18px}
    label{display:block;font-size:.9rem;color:#cbd5e1;margin:14px 0 6px}
    input,select,textarea{width:100%;padding:12px;border-radius:12px;border:1px solid var(--stroke);
      background:var(--input);color:var(--text);font-size:1rem;outline:none;}
    input:focus,select:focus,textarea:focus{border-color:var(--brand)}
    button{width:100%;margin-top:18px;padding:12px 14px;border:none;border-radius:12px;
      background:linear-gradient(180deg,var(--brand),var(--brand-2));color:white;font-weight:700;cursor:pointer;}
    button:disabled{opacity:.55;cursor:not-allowed}
    .msg{margin-top:12px;font-weight:600;display:none}
    .msg.ok{color:var(--ok)}.msg.err{color:var(--err)}
    .foot{margin-top:12px;font-size:.8rem;color:var(--muted);text-align:center}
  </style>
</head>
<body>
<div class="wrap"><div class="grid">
<main class="card form">
<div class="header">
  <img src="../assets/logo.png" alt="Logo Kuzmanich Seguros 360">
  <div><h1>Solicitud de cotizaci√≥n</h1><div class="sub">Atenci√≥n profesional en seguros personales y empresariales.</div></div>
</div>

<form id="leadForm" novalidate>
  <label>Nombre completo</label>
  <input id="nombre" required placeholder="Ej: Mart√≠n Kuzmanich">
  <label>Tel√©fono (con c√≥digo de √°rea)</label>
  <input id="telefono" required placeholder="+54 9 351 000 0000" inputmode="tel">

  <label>Email</label>
  <input id="email" type="email" placeholder="tu@email.com">

  <label>Ramo</label>
  <select id="ramo" required>
    <option value="">Seleccion√°‚Ä¶</option>
    <option value="retiro">Seguro de Retiro</option>
    <option value="automotor">Automotor</option>
    <option value="vida">Vida</option>
    <option value="hogar">Hogar</option>
    <option value="salud">Salud</option>
    <option value="empresas">Empresas</option>
  </select>

  <!-- Bloque Retiro -->
  <div id="retiroFields" style="display:none;margin-top:10px">
    <label>Edad actual</label><input id="retiro_edad" inputmode="numeric" placeholder="Ej: 35">
    <label>Edad de retiro deseada</label><input id="retiro_meta" inputmode="numeric" placeholder="Ej: 65">
    <label>Aporte mensual (ARS)</label><input id="retiro_aporte" inputmode="numeric" placeholder="Ej: 40000">
    <button type="button" id="btnCalc">Calcular proyecci√≥n</button>
    <div id="calcResult" style="margin-top:8px;font-size:.9rem;color:#93c5fd;display:none"></div>
  </div>

  <!-- Bloque Automotor -->
  <div id="autoFields" style="display:none;margin-top:10px">
    <label>Marca</label><select id="auto_marca"></select>
    <label>Modelo</label><select id="auto_modelo" disabled></select>
    <label>Versi√≥n</label><select id="auto_version" disabled></select>
    <label>A√±o</label><select id="auto_anio_sel" disabled></select>
    <label>DNI tomador</label><input id="auto_dni" inputmode="numeric" placeholder="Ej: 12555777">
  </div>

  <label class="consent">
    <input id="consent" type="checkbox" required> Acepto el uso de mis datos (Ley 25.326)
  </label>

  <button id="submitBtn" type="submit" disabled>Enviar solicitud</button>
  <div id="msg" class="msg"></div>

  <div id="postActions" style="display:none;margin-top:12px">
    <button type="button" id="btnWa">üì≤ Chatear ahora por WhatsApp</button>
  </div>
</form>

<div class="foot">Kuzmanich Seguros 360 ¬∑ Atenci√≥n personalizada</div>
</main>
<aside class="card aside"><h3>¬øPor qu√© con nosotros?</h3><ul>
<li>Productores oficiales.</li><li>Respuesta √°gil por WhatsApp.</li><li>Tus datos quedan protegidos.</li></ul></aside>
</div></div>

<script>
const URL="https://orgkuzmanich.app.n8n.cloud/webhook/lead-ingest";
const WA_NUMBER="5942804641495";

const form=document.getElementById("leadForm"),msg=document.getElementById("msg"),
btn=document.getElementById("submitBtn"),cons=document.getElementById("consent"),
ramo=document.getElementById("ramo"),post=document.getElementById("postActions"),
btnWa=document.getElementById("btnWa");

// Retiro
const fRetiro=document.getElementById("retiroFields"),
rEdad=document.getElementById("retiro_edad"),
rMeta=document.getElementById("retiro_meta"),
rAporte=document.getElementById("retiro_aporte"),
btnCalc=document.getElementById("btnCalc"),
calcDiv=document.getElementById("calcResult");

// Auto
const fAuto=document.getElementById("autoFields"),
sMarca=document.getElementById("auto_marca"),
sModelo=document.getElementById("auto_modelo"),
sVersion=document.getElementById("auto_version"),
sAnio=document.getElementById("auto_anio_sel"),
aDni=document.getElementById("auto_dni");
let AUTO_TREE=null;

// consent
cons.addEventListener("change",()=>btn.disabled=!cons.checked);

ramo.addEventListener("change",async()=>{
  fRetiro.style.display=ramo.value==="retiro"?"block":"none";
  fAuto.style.display=ramo.value==="automotor"?"block":"none";
  post.style.display="none"; msg.style.display="none";
  if(ramo.value==="automotor"&&!AUTO_TREE) await loadAutoTree();
});

async function loadAutoTree(){
  try{
    const r=await fetch("./Autos_arbol.json",{cache:"no-store"});
    AUTO_TREE=await r.json();
    const marcas=Object.keys(AUTO_TREE).sort();
    fillSel(sMarca,marcas,"Seleccion√° marca");
  }catch(e){console.error(e);}
}
function fillSel(sel,arr,ph){
  sel.innerHTML=`<option value="">${ph}</option>`;
  (arr||[]).forEach(v=>{const o=document.createElement("option");o.textContent=v;o.value=v;sel.appendChild(o);});
  sel.disabled=!(arr&&arr.length);
}
sMarca.addEventListener("change",()=>{
  const m=sMarca.value;
  if(!m){fillSel(sModelo,[], "Seleccion√° modelo");return;}
  fillSel(sModelo,Object.keys(AUTO_TREE[m]).sort(),"Seleccion√° modelo");
});
sModelo.addEventListener("change",()=>{
  const M=sMarca.value,mo=sModelo.value;
  fillSel(sVersion,Object.keys(AUTO_TREE[M][mo]||{}),"Seleccion√° versi√≥n");
});
sVersion.addEventListener("change",()=>{
  const M=sMarca.value,mo=sModelo.value,v=sVersion.value;
  fillSel(sAnio,AUTO_TREE[M][mo][v]||[],"Seleccion√° a√±o");
});

// c√°lculo retiro
btnCalc.addEventListener("click",()=>{
  const edad=+rEdad.value,meta=+rMeta.value,aporte=+rAporte.value;
  if(!edad||!meta||!aporte||meta<=edad){alert("Complet√° los datos v√°lidos.");return;}
  const a√±os=meta-edad,t1=0.40,t2=0.30;
  const acum=tasa=>aporte*(((1+tasa)**a√±os-1)/tasa);
  const esc1=Math.round(acum(t1)).toLocaleString("es-AR"),esc2=Math.round(acum(t2)).toLocaleString("es-AR");
  calcDiv.style.display="block";calcDiv.innerHTML=`Escenario 1 (40 %): <b>$${esc1}</b><br>Escenario 2 (30 %): <b>$${esc2}</b>`;
  rEdad.dataset.esc1=esc1;rEdad.dataset.esc2=esc2;
});

// env√≠o
form.addEventListener("submit",async e=>{
  e.preventDefault();msg.style.display="none";msg.className="msg";
  if(!form.checkValidity()){msg.textContent="Revis√° los campos.";msg.classList.add("err");msg.style.display="block";return;}
  btn.disabled=true;btn.textContent="Enviando‚Ä¶";

  const data={
    nombre:document.getElementById("nombre").value.trim(),
    telefono:document.getElementById("telefono").value.trim(),
    email:document.getElementById("email").value.trim(),
    ramo:ramo.value,
    canal:"web",estado:"nuevo",asesor:"auto",origen:"form",comentarios:"",
    auto_mmv:`${sMarca.value} ${sModelo.value} ${sVersion.value}`.trim(),
    auto_anio:sAnio.value||"",auto_dni:aDni.value||"",
    retiro_edad:rEdad.value||"",retiro_meta:rMeta.value||"",retiro_aporte:rAporte.value||"",
    retiro_esc1:rEdad.dataset.esc1||"",retiro_esc2:rEdad.dataset.esc2||""
  };
  try{
    await fetch(URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)});
    msg.textContent="‚úÖ ¬°Solicitud enviada correctamente!";
    msg.classList.add("ok");msg.style.display="block";
    post.style.display="block";
    btnWa.onclick=()=>{
      const base=`Hola, soy ${data.nombre}. Quiero cotizar *${data.ramo.toUpperCase()}*.\n\n`;
      let detalle="";
      if(data.ramo==="retiro"){
        detalle=`Edad actual: ${data.retiro_edad}\nEdad retiro: ${data.retiro_meta}\nAporte mensual: ${data.retiro_aporte}\nProyecci√≥n: ${data.retiro_esc1}`;
      }else if(data.ramo==="automotor"){
        detalle=`Veh√≠culo: ${data.auto_mmv}\nA√±o: ${data.auto_anio}\nDNI: ${data.auto_dni}`;
      }
      window.open(`https://wa.me/${WA_NUMBER}?text=${encodeURIComponent(base+detalle)}`,"_blank");
    };
  }catch(err){
    console.error(err);
    msg.textContent="‚ùå No pudimos enviar tu solicitud.";
    msg.classList.add("err");msg.style.display="block";
  }
  btn.disabled=false;btn.textContent="Enviar solicitud";
});
</script>
</body>
</html>
